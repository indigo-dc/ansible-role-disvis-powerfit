---
- name: Install necessary packages
  apt: name={{ item }} state=latest update_cache=yes
  with_items:
    - cmake
    - cython
    - libclfft-bin
    - libclfft-dev
    - libclfft2
    - libffi-dev
    - libfftw3-double3
    - libfftw3-single3
    - libfftw3-long3
    - libfftw3-dev
    - libxml2-dev
    - libxslt1-dev
    - python-mako
    - python-numpy
    - python-pyfftw
    - python-scipy
    - python-virtualenv

# Try the install from packages instead of the git
#- name: clone git repositories
#  git: repo={{ item.repo }} dest={{ item.dest }} clone=yes
#  with_items:
#    - { repo: "https://github.com/clMathLibraries/clFFT.git", dest: "/usr/local/clFFT" }

- name: clone git repositories disvis or powerfit
  git: repo={{ item.repo }} dest={{ item.dest }} clone=yes
  with_items:
    - { repo: "https://github.com/haddocking/{{ haddock_app }}.git", dest: "/usr/local/{{ haddock_app }}" }

- name: unarchive opencl headers
  unarchive: src={{ opencl_url }} dest=/usr/include copy=no

#- name: install clFFT - configure
#  command: cmake CMakeLists.txt chdir=/usr/local/clFFT/src
#  env:
#    LD_LIBRARY_PATH: /usr/lib/x86_64-linux-gnu

#- name: make install clFFT
#  command: make install chdir=/usr/local/clFFT/src
#  env:
#    LD_LIBRARY_PATH: /usr/lib/x86_64-linux-gnu

#- name: pip install python modules
#  pip: name={{ item }} state=latest
#  with_items:
#    - Cython

- name: pip install pyopencl
  pip: name=pyopencl

- name: pip install gpyfft
  pip: name="git+https://github.com/geggo/gpyfft.git" editable=false state=present

- name: pip install gpyfft and {{ haddock_app }}
  pip: name={{ item }} state=present
  with_items:
    - "file:///usr/local/{{ haddock_app }}"

- name: unarchive powerfit examples
  unarchive: src=http://www.lip.pt/~david/powerfit-example.tgz dest=/home copy=no
  when: haddock_app == "powerfit"
